<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>P了么 - AI 创作</title>
    <link rel="stylesheet" href="/common/styles.css?v=20260112" />
    <link rel="stylesheet" href="/common/styles-enhance.css" />
    <link rel="stylesheet" href="/pages/home/home.css" />
    <link rel="stylesheet" href="/pages/generate/generate-layout.css" />
  </head>
  <body>
    <!-- 导航栏容器 -->
    <div id="navbar-container"></div>

    <!-- 用户信息栏 -->
    <div style="max-width:1400px;margin:0 auto;padding:12px 24px;display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.03);border-bottom:1px solid rgba(255,255,255,0.1)">
      <div>
        <span id="me" style="color:#ffffff;font-weight:500">未登录</span>
      </div>
      <div>
        <span id="quota" class="quota" style="color:rgba(255,255,255,0.7);font-size:14px"></span>
      </div>
    </div>

    <main class="generate-layout" style="margin-top:0">
      <!-- 模态框容器（登录/注册） -->
      <div id="modals-container"></div>

      <!-- 图片预览模态框 -->
      <div id="imageModal" class="modal" hidden>
        <div class="modalCard imageModalCard" role="dialog" aria-modal="true" aria-labelledby="imageTitle">
          <div class="modalHeader">
            <div id="imageTitle" class="modalTitle">预览</div>
            <button class="iconBtn" type="button" data-close-modal="imageModal" aria-label="关闭">×</button>
          </div>
          <div class="modalBody imageViewer">
            <div class="image-compare-container">
              <img id="imageModalImgOriginal" class="compare-original" alt="original" />
              <img id="imageModalImg" class="compare-new" alt="preview" />
              <div class="compare-slider-line" id="compareSliderLine"></div>
              <div class="compare-slider-wrapper" id="compareSliderWrapper" hidden>
                <input id="compareRange" type="range" min="0" max="100" value="0" step="1" />
                <div class="compare-labels">
                  <span class="compare-label-left">原图</span>
                  <span class="compare-label-right">新图</span>
                </div>
              </div>
            </div>
          </div>
          <div class="modalFooter">
            <div class="modalTools">
              <span class="muted">缩放</span>
              <input id="zoomRange" type="range" min="100" max="300" value="100" step="5" />
              <span id="zoomValue" class="badge">100%</span>
            </div>
            <a id="imageModalOpen" class="secondary" href="#" target="_blank" rel="noreferrer">下载原图</a>
            <button id="toggleOriginal" class="secondary" type="button" aria-pressed="false">显示原图</button>
            <button id="prevImage" class="secondary" type="button">上一张</button>
            <button id="nextImage" class="secondary" type="button">下一张</button>
            <button class="secondary" type="button" data-close-modal="imageModal">关闭</button>
          </div>
        </div>
      </div>

      <div id="paintModal" class="modal" hidden>
        <div class="modalCard imageModalCard" role="dialog" aria-modal="true" aria-labelledby="paintTitle">
          <div class="modalHeader">
            <div id="paintTitle" class="modalTitle">原图涂抹</div>
            <button class="iconBtn" type="button" data-close-modal="paintModal" aria-label="关闭">×</button>
          </div>
          <div class="modalBody imageViewer">
            <canvas id="paintCanvas"></canvas>
          </div>
          <div class="modalFooter">
            <div class="modalTools">
              <span class="muted">缩放</span>
              <input id="paintZoomRange" type="range" min="100" max="300" value="100" step="5" />
              <span id="paintZoomValue" class="badge">100%</span>
              <div class="paintTools">
                <span class="muted">画笔</span>
                <input id="paintColor" type="color" value="#ff0000" title="颜色" />
                <span class="muted">羽化</span>
                <input id="paintFeather" type="range" min="0" max="100" value="40" step="1" />
                <span class="muted">画笔粗细</span>
                <input id="paintSize" type="range" min="10" max="100" value="28" step="1" />
                <span id="paintSizeValue" class="badge">28</span>
                <button id="paintUndo" class="secondary" type="button">撤销</button>
                <button id="paintReset" class="secondary" type="button">重置</button>
              </div>
            </div>
            <button id="paintPrev" class="secondary" type="button">上一张</button>
            <button id="paintNext" class="secondary" type="button">下一张</button>
            <button class="secondary" type="button" data-close-modal="paintModal">关闭</button>
          </div>
        </div>
      </div>


      <!-- 左侧工具栏 -->
      <div class="generate-left">
      <section class="card" data-auth="required">
        <div class="tabs" role="tablist" aria-label="生成模式">
          <button id="tabBtnImg2Img" class="tabBtn active" type="button" role="tab" aria-selected="true" aria-controls="tabImg2Img">
            修图
          </button>
          <button id="tabBtnTxt2Img" class="tabBtn" type="button" role="tab" aria-selected="false" aria-controls="tabTxt2Img">
            生图
          </button>
        </div>
      </section>

      <div id="tabImg2Img" class="tabPanel" role="tabpanel" aria-labelledby="tabBtnImg2Img">
        <section class="card" data-auth="required">
        <div class="row">
          <div>
            <label class="label" for="modelId">选择模型</label>
            <div class="modelPick selectWrap">
              <select id="modelId" title="选择模型">
                <option value="dashscope" selected>快速修图</option>
                <option value="google-nano-banana-pro">精修（速度较慢，失败请重试）</option>
                <option value="jimeng">即梦4.0（支持4K超清，速度适中）</option>
              </select>
            </div>
          </div>
        </div>

        <div class="row">
          <label class="label">选择图片</label>
          <div class="filePicker">
            <input id="images" class="fileInput" type="file" accept="image/*" multiple />
            <label class="fileBtn" for="images">选择图片</label>
            <div id="fileInfo" class="fileInfo">未选择</div>
          </div>
          <div class="hint">可同时选择多张（最多 3 张）。</div>
          <div id="fileError" class="formError" hidden></div>
        </div>

        <div id="preview" class="preview"></div>
        <div id="baseIndexWrap" class="row baseIndex" hidden>
          <div class="baseIndexInner">
            <div class="muted">底图（被修改的那张）</div>
            <div class="selectWrap">
              <select id="baseIndex"></select>
            </div>
          </div>
          <div class="hint">如果你希望“把第 1 张 P 成第 2 张的效果”，通常应选择底图为第 1 张。</div>
        </div>
      </section>

      <section class="card guest" data-auth="guest">
        <div class="guestInner">
          <div class="guestTitle">登录后开始修图</div>
          <div class="guestDesc">右上角快速登录/注册</div>
          <div class="guestActions">
            <button id="guestLogin" class="primary" type="button">登录</button>
            <button id="guestRegister" class="secondary" type="button">注册</button>
          </div>
        </div>
      </section>

      <section class="card" data-auth="required">
        <div class="row">
          <div>
            <label class="label" for="n">生成数量（1–6）</label>
            <input id="n" type="number" min="1" max="6" value="2" />
            <div id="nHint" class="hint"></div>
          </div>
        </div>

        <div class="row">
          <label class="label" for="prompt">Prompt</label>
          <div style="display: flex; gap: 8px; margin-bottom: 8px;">
            <button id="enhancePrompt" class="secondary" type="button" style="flex: 1;" title="使用 AI 自动增强 Prompt">
              ✨ 一键美化
            </button>
            <button id="extractStyle" class="secondary" type="button" style="flex: 1;" title="从上传的图片提取风格">
              🎨 提取风格
            </button>
          </div>
          <textarea id="prompt" rows="5" placeholder="描述你希望生成的效果…"></textarea>
          <div class="effectGroups">
            <div class="effectGroup">
              <div class="effectTitle">影调调整</div>
              <div class="chips">
                <button class="chip" type="button" data-prompt="电影调色">电影调色</button>
                <button class="chip" type="button" data-prompt="日系清透">日系清透</button>
                <button class="chip" type="button" data-prompt="HDR 质感">HDR 质感</button>
                <button class="chip" type="button" data-prompt="暗角">暗角</button>
                <button class="chip" type="button" data-prompt="胶片颗粒">胶片颗粒</button>
                <button class="chip" type="button" data-prompt="色温调整-暖">色温调整-暖</button>
                <button class="chip" type="button" data-prompt="色温调整-冷">色温调整-冷</button>
                <button class="chip" type="button" data-prompt="去噪">去噪</button>
                <button class="chip" type="button" data-prompt="锐化细节">锐化细节</button>
                <button class="chip" type="button" data-prompt="背景虚化">背景虚化</button>
              </div>
            </div>

            <div class="effectGroup">
              <div class="effectTitle">面容调整</div>
              <div class="chips">
                <button class="chip" type="button" data-prompt="肤色校正">肤色校正</button>
                <button class="chip" type="button" data-prompt="去油光">去油光</button>
                <button class="chip" type="button" data-prompt="美白牙齿">美白牙齿</button>
                <button class="chip" type="button" data-prompt="眼神增强">眼神增强</button>
                <button class="chip" type="button" data-prompt="大眼高光">大眼高光</button>
                <button class="chip" type="button" data-prompt="妆容增强">妆容增强</button>
                <button class="chip" type="button" data-prompt="水润面妆">水润面妆</button>
                <button class="chip" type="button" data-prompt="面部高光">面部高光</button>
                <button class="chip" type="button" data-prompt="二次元柔光">二次元柔光</button>
                <button class="chip" type="button" data-prompt="头发飘逸">头发飘逸</button>
              </div>
              <div class="faceControls">
                <label class="check">
                  <input id="faceRedraw" type="checkbox" />
                  <span>面部重绘</span>
                </label>
                <div class="strength">
                  <span class="muted">重绘程度</span>
                  <input id="faceStrength" type="range" min="1" max="5" value="3" />
                  <span id="faceStrengthValue" class="badge">3</span>
                </div>
              </div>
            </div>

            <div class="effectGroup">
              <div class="effectTitle">环境调整</div>
              <div class="chips">
                <button class="chip" type="button" data-prompt="固定人物">固定人物</button>
                <button class="chip" type="button" data-prompt="闪电效果">闪电效果</button>
                <button class="chip" type="button" data-prompt="武器发光">武器发光</button>
                <button class="chip" type="button" data-prompt="火焰特效">火焰特效</button>
                <button class="chip" type="button" data-prompt="能量光环">能量光环</button>
                <button class="chip" type="button" data-prompt="霓虹光效">霓虹光效</button>
                <button class="chip" type="button" data-prompt="粒子效果">粒子效果</button>
                <button class="chip" type="button" data-prompt="烟雾效果">烟雾效果</button>
                <button class="chip" type="button" data-prompt="体积光">体积光</button>
                <button class="chip" type="button" data-prompt="逆光轮廓光">逆光轮廓光</button>
                <button class="chip" type="button" data-prompt="光斑漏光">光斑漏光</button>
                <button class="chip" type="button" data-prompt="雨天氛围">雨天氛围</button>
                <button class="chip" type="button" data-prompt="雪花效果">雪花效果</button>
                <button class="chip" type="button" data-prompt="尘埃粒子">尘埃粒子</button>
                <button class="chip" type="button" data-prompt="舞台灯光">舞台灯光</button>
                <button class="chip" type="button" data-prompt="舞台光晕">舞台光晕</button>
                <button class="chip" type="button" data-prompt="彩灯散景">彩灯散景</button>
                <button class="chip" type="button" data-prompt="樱花氛围">樱花氛围</button>
                <button class="chip" type="button" data-prompt="星光闪粉">星光闪粉</button>
                <button class="chip" type="button" data-prompt="速度线">速度线</button>
                <button class="chip" type="button" data-prompt="去路人">去路人</button>
                <button class="chip" type="button" data-prompt="背景简化">背景简化</button>
                <button class="chip" type="button" data-prompt="漫展补光">漫展补光</button>
                <button class="chip" type="button" data-prompt="去反光">去反光</button>
                <button class="chip" type="button" data-prompt="服装质感">服装质感</button>
                <button class="chip" type="button" data-prompt="假发发丝修复">假发发丝修复</button>
                <button class="chip" type="button" data-prompt="降摩尔纹">降摩尔纹</button>
                <button class="chip" type="button" data-prompt="漫画线稿">漫画线稿</button>
                <button class="chip" type="button" data-prompt="赛璐璐光影">赛璐璐光影</button>
                <button class="chip" type="button" data-prompt="漫画网点">漫画网点</button>
              </div>
            </div>
          </div>
          <div class="hint">点击上方按钮会自动追加预设 prompt 片段。</div>
        </div>

        <div class="row">
          <label class="check">
            <input id="hd" type="checkbox" />
            <span>超清</span>
          </label>
          <div class="hint">勾选后会按输入图片比例，将输出尺寸最长边提升到 2048px。</div>
        </div>

        <div class="row actions">
          <button id="submit" class="primary" type="button">开始生成</button>
          <button id="clear" class="secondary" type="button">清空</button>
          <div id="status" class="status"></div>
        </div>
      </section>
      </div>

      <div id="tabTxt2Img" class="tabPanel" role="tabpanel" aria-labelledby="tabBtnTxt2Img" hidden>
        <section class="card" data-auth="required">
          <div class="row">
            <div class="grid2">
              <div>
                <label class="label" for="modelIdText">选择模型</label>
                <div class="modelPick selectWrap">
                  <select id="modelIdText" title="选择模型">
                    <option value="dashscope" selected>快速生成</option>
                    <option value="google-nano-banana-pro">精修（速度较慢，失败请重试）</option>
                    <option value="jimeng">即梦4.0（支持4K超清，速度适中）</option>
                  </select>
                </div>
              </div>
              <div>
                <label class="label" for="aspectRatioText">画幅比例</label>
                <div class="selectWrap">
                  <select id="aspectRatioText" title="画幅比例">
                    <option value="1:1" selected>1:1（方形）</option>
                    <option value="4:3">4:3（横向）</option>
                    <option value="3:4">3:4（纵向）</option>
                    <option value="16:9">16:9（宽屏）</option>
                    <option value="9:16">9:16（竖屏）</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div>
              <label class="label" for="nText">生成数量（1–6）</label>
              <input id="nText" type="number" min="1" max="6" value="2" />
              <div id="nHintText" class="hint"></div>
            </div>
          </div>

          <div class="row">
            <label class="label" for="promptText">Prompt</label>
            <div style="display: flex; gap: 8px; margin-bottom: 8px;">
              <button id="enhancePromptText" class="secondary" type="button" style="flex: 1;" title="使用 AI 自动增强 Prompt">
                ✨ 一键美化
              </button>
            </div>
            <textarea id="promptText" rows="5" placeholder="描述你希望生成的画面…"></textarea>
            <div class="effectGroups">
              <div class="effectGroup">
                <div class="effectTitle">预设效果</div>
                <div class="chips">
                  <button class="chip" type="button" data-prompt-text="纯色背景（方便抠图），背景干净，和主体颜色有反差，无渐变，无杂物，无阴影投射到背景上。">纯色背景（方便抠图）</button>
                  <button class="chip" type="button" data-prompt-text="产品棚拍风格，纯白背景，柔光箱打光，阴影自然，细节清晰。">白底产品图</button>
                  <button class="chip" type="button" data-prompt-text="电影级光影，浅景深，真实质感，细节丰富，高动态范围。">电影质感</button>
                  <button class="chip" type="button" data-prompt-text="二次元插画风，干净线条，柔和光照，高质量细节。">二次元插画</button>
                </div>
              </div>
            </div>
            <div class="hint">示例：二次元女孩，樱花雨，电影级光影，超清细节。</div>
          </div>

          <div class="row">
            <label class="check">
              <input id="hdText" type="checkbox" />
              <span>超清</span>
            </label>
            <div class="hint">勾选后会提升输出分辨率（不同模型表现略有差异）。</div>
          </div>

          <div class="row actions">
            <button id="submitText" class="primary" type="button">开始生成</button>
            <button id="clearText" class="secondary" type="button">清空</button>
            <div id="statusText" class="status"></div>
          </div>
        </section>
      </div>

      <footer class="footer">
        <div>提示：点击【生成】按钮后，请耐心等到，一般 1min 内可生成</div>
      </footer>
      </div>

      <!-- 右侧结果展示区 -->
      <div class="generate-right">
        <section class="card" data-auth="required">
          <h2 class="h2">创作结果</h2>
          <div id="results" class="results"></div>
          <div id="resultsText" class="results"></div>
        </section>
      </div>
    </main>

    <!-- 公共脚本 -->
    <script src="/common/components.js"></script>
    <script src="/common/auth.js"></script>
    <script>
      // 初始化组件
      Components.init({ activePage: 'generate' });
      // 初始化认证
      Auth.init();
    </script>
    <script src="/pages/generate/app.js?v=20260112"></script>
  </body>
</html>
